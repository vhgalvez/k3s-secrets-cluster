# playbooks\run_all_secrets_pipeline.yml
---
- name: ğŸš€ Ejecuta todo el flujo completo de secretos (full pipeline)
  hosts: localhost
  become: true
  gather_facts: false

  tasks:
    - name: ğŸ› ï¸ Instalar kubeseal en localhost
      include_playbook: 00_setup_kubeseal.yml

    - name: ğŸš€ Despliega el controller de Sealed Secrets en el clÃºster
      include_playbook: 01_deploy_sealed_secrets.yml

    - name: ğŸ“ Genera archivos YAML base desde variables (secrets planos)
      include_playbook: 02_generate_secret_templates.yml

    - name: ğŸ” Renderiza plantillas Jinja2 y las cifra con kubeseal
      include_playbook: 03_render_and_seal_secrets.yml

    - name: ğŸ” Crea secretos con autenticaciÃ³n bÃ¡sica htpasswd
      include_playbook: 04_generate_htpasswd_secrets.yml
      when: htpasswd_enabled | default(false)

    - name: ğŸ” Sella archivos YAML ya generados manualmente
      include_playbook: 05_seal_existing_yaml.yml
      when: manual_sealing_enabled | default(false)